#!/usr/bin/env ruby
require 'optparse'
require 'projectify'
require 'colorize'

options = {}

OptionParser.new do |opts|
  opts.banner = "Usage: projectify [options]"

  opts.on("-t", "--type=type", "Define the type for your project (general/drupal/capistrano). If this is empty, drupal will be used.") do |project_type|
    options[:project_type] = project_type
  end
  
  opts.on("-d", "--directory=DIRECTORY", "Define the directory for this project. This is required!.") do |directory|
    options[:directory] = directory
  end
end.parse!


if !ARGV[0].include? "."
  if ARGV.length == 1
    puts "Don't forget the directory argument!"
    exit
  end
end

location = ""

if options[:directory].include? "."
  if options[:directory].include? "/"
    location = options[:directory]
    if options[:directory][-1, 1] != "/"
      location = location + "/"
    end
  else
    location = options[:directory] + "/"
  end
end

puts "Creating directory structure"

if options[:project_type] == "drupal"
  if Projectify.create_dir_drupal(location) == true
    puts "Creating drupal directory structure succeeded [" + "SUCCES".green + "]"
  else
    puts "Creation of drupal directory structure failed [" + "ERROR".red + "]"
  end
elsif options[:project_type] == "capistrano"
  if Projectify.create_dir_default(location) == true
    puts "Creating default directory structure succeeded [" + "SUCCES".green + "]"
  else
    puts "Creation of default directory structure failed [" + "ERROR".red + "]"
  end
elsif options[:project_type].include? "."
  if Projectify.create_dir_drupal(location) == true
    puts "Creating drupal directory structure succeeded [" + "SUCCES".green + "]"
  else
    puts "Creation of drupal directory structure failed [" + "ERROR".red + "]"
  end
end

if Projectify.create_structure(location + "vagrant")
  puts "Creating vagrant directory... [" + "SUCCESS".green + "]"
 else
  puts "Creating vagrant directory... [" + "FAILED".red + "]"
end

if Projectify.create_structure(location + "docroot")
  puts "Creating docroot directory... [" + "SUCCESS".green + "]"
 else
  puts "Creating docroot directory... [" + "FAILED".red + "]"
end

if Projectify.create_structure(location + "node_modules")
  puts "Creating node_modules directory... [" + "SUCCESS".green + "]"
 else
  puts "Creating node_modules directory... [" + "FAILED".red + "]"
end

if Projectify.create_structure(location + "scripts")
  puts "Creating scripts directory... [" + "SUCCESS".green + "]"
 else
  puts "Creating scripts directory... [" + "FAILED".red + "]"
end
