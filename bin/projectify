#!/usr/bin/env ruby
require 'optparse'
require 'projectify'
require 'colorize'

options = {}

OptionParser.new do |opts|
  opts.banner = "Usage: projectify [options]"

  opts.on("-t", "--type=type", "Define the type for your project (general/drupal/capistrano). If this is empty, drupal will be used.") do |project_type|
    options[:project_type] = project_type
  end
  
  opts.on("-d", "--directory=DIRECTORY", "Define the directory for this project. This is required!.") do |directory|
    options[:directory] = directory
  end
    
  opts.on("-p", "--project_name=PROJECTNAME", "Define the project name for your project. If this is empty, \"CrossCheck\" will be used.") do |project_name|
    options[:project_name] = project_name
  end
    
  opts.on("-h", "--host_name=DOMAIN", "Define the local domain for your project. If this is empty, PROJECTNAME.dev will be used.") do |domain|
    options[:domain] = domain
  end    
end.parse!

########## Option checks ##########
if options[:directory].length <= 1
    puts "You have to define a directory!".red
    exit
end

if options[:project_name].length <= 1
    puts "You have to define a project name!".red
end
########## Option checks ##########

########## Basic directory structure ##########
location = ""

if options[:directory].include? "."
  if options[:directory].include? "/"
    location = options[:directory]
    if options[:directory][-1, 1] != "/"
      location = location + "/"
    end
  else
    location = options[:directory] + "/"
  end
end

puts "Creating directory structure"
if options.has_key?(:project_type)
    if options[:project_type] == "drupal"
      if Projectify.create_dir_drupal(location) == true
        puts "Creating drupal directory structure succeeded [" + "SUCCES".green + "]"
      else
        puts "Creation of drupal directory structure failed [" + "ERROR".red + "]"
      end
    elsif options[:project_type] == "capistrano"
      if Projectify.create_dir_default(location) == true
        puts "Creating default directory structure succeeded [" + "SUCCES".green + "]"
      else
        puts "Creation of default directory structure failed [" + "ERROR".red + "]"
      end
    else
      if Projectify.create_dir_drupal(location) == true
        puts "Creating drupal directory structure succeeded [" + "SUCCES".green + "]"
      else
        puts "Creation of drupal directory structure failed [" + "ERROR".red + "]"
      end
    end
else
    if Projectify.create_dir_drupal(location) == true
        puts "Creating drupal directory structure succeeded [" + "SUCCES".green + "]"
    else
        puts "Creation of drupal directory structure failed [" + "ERROR".red + "]"
    end  
end

if Projectify.create_structure(location + "vagrant")
  puts "Creating vagrant directory... [" + "SUCCESS".green + "]"
 else
  puts "Creating vagrant directory... [" + "FAILED".red + "]"
end

if Projectify.create_structure(location + "docroot")
  puts "Creating docroot directory... [" + "SUCCESS".green + "]"
 else
  puts "Creating docroot directory... [" + "FAILED".red + "]"
end

if Projectify.create_structure(location + "node_modules")
  puts "Creating node_modules directory... [" + "SUCCESS".green + "]"
 else
  puts "Creating node_modules directory... [" + "FAILED".red + "]"
end

if Projectify.create_structure(location + "scripts")
  puts "Creating scripts directory... [" + "SUCCESS".green + "]"
 else
  puts "Creating scripts directory... [" + "FAILED".red + "]"
end

########## Basic Directory Structure ##########

########## Basic File Structure ##########

if Projectify.create_script_directories(location)
    puts "Creating specific directory structures... [" + "SUCCESS".green + "]"
else
    puts "Creating specific directory structures... [" + "FAILED".red + "]"    
end

if Projectify.create_script_files(location)
    puts "Creating script files... [" + "SUCCESS".green + "]"
else
    puts "Creating script files... [" + "FAILED".red + "]"    
end

if Projectify.create_varnish_files(location)
    puts "Creating varnish files... [" + "SUCCESS".green + "]"
else
    puts "Creating varnish files... [" + "FAILED".red + "]"    
end

if Projectify.create_gem_files(location)
    puts "Creating gem files... [" + "SUCCESS".green + "]"
else
    puts "Creating gem files... [" + "FAILED".red + "]"    
end

if Projectify.create_npm_files(location)
    puts "Creating npm files... [" + "SUCCESS".green + "]"
else
    puts "Creating npm files... [" + "FAILED".red + "]"    
end

##########################################